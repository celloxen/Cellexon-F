<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lily Health Consultant - Celloxen Bioelectronic Wellness Platform</title>
    <style>
        /* Keep all your existing excellent styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        
        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .logo {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .lily-info h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .lily-info p {
            color: #cbd5e1;
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .session-info {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-left: 4px solid #1e3a8a;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .session-badge {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .chat-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            height: 70vh;
            display: flex;
            flex-direction: column;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
            scroll-behavior: smooth;
        }
        
        .message-wrapper {
            display: flex;
            align-items: flex-end;
            gap: 10px;
            animation: slideIn 0.4s ease;
        }
        
        .message-wrapper.lily-wrapper {
            align-self: flex-start;
        }
        
        .message-wrapper.user-wrapper {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
        
        .message {
            max-width: 70%;
            padding: 14px 18px;
            border-radius: 18px;
            line-height: 1.5;
            font-size: 0.95rem;
            white-space: pre-line;
        }
        
        .lily-message {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            color: #1f2937;
            border-bottom-left-radius: 6px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }
        
        .user-message {
            background: linear-gradient(135deg, #1e3a8a, #1e40af);
            color: white;
            border-bottom-right-radius: 6px;
            box-shadow: 0 2px 10px rgba(30, 58, 138, 0.3);
        }
        
        .processing {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 1px solid #fbbf24;
            color: #92400e;
            padding: 14px 18px;
            border-radius: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-style: italic;
        }
        
        .dots {
            display: flex;
            gap: 4px;
        }
        
        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #92400e;
            animation: bounce 1.4s ease-in-out infinite;
        }
        
        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }
        .dot:nth-child(3) { animation-delay: 0; }
        
        @keyframes bounce {
            0%, 80%, 100% { 
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% { 
                transform: scale(1.2);
                opacity: 1;
            }
        }
        
        .multiple-choice {
            margin-top: 15px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .choice-button {
            background: white;
            border: 2px solid #e2e8f0;
            padding: 12px 16px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 0.9rem;
        }
        
        .choice-button:hover {
            border-color: #1e3a8a;
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.15);
        }
        
        .question-progress {
            background: #e2e8f0;
            height: 4px;
            border-radius: 2px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .question-progress-bar {
            background: linear-gradient(90deg, #10b981, #059669);
            height: 100%;
            border-radius: 2px;
            transition: width 0.5s ease;
        }
        
        .therapy-recommendation {
            background: #f0f9ff;
            border-left: 4px solid #0284c7;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        
        .therapy-title {
            font-weight: 600;
            color: #0c4a6e;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .therapy-code {
            display: inline-block;
            background: #0284c7;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .therapy-details {
            color: #475569;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        .supplement-box {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            padding: 12px;
            margin-top: 10px;
            border-radius: 6px;
        }
        
        .supplement-title {
            font-weight: 600;
            color: #92400e;
            margin-bottom: 8px;
        }
        
        .input-area {
            padding: 20px 25px;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-top: 1px solid #e2e8f0;
        }
        
        .input-container {
            display: flex;
            gap: 12px;
            max-width: 800px;
            margin: 0 auto;
            align-items: center;
        }
        
        .input-field {
            flex: 1;
            padding: 14px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 30px;
            outline: none;
            font-size: 16px;
            background: white;
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            border-color: #1e3a8a;
            box-shadow: 0 0 0 4px rgba(30, 58, 138, 0.1);
        }
        
        .input-field:disabled {
            background: #f1f5f9;
            color: #9ca3af;
            cursor: not-allowed;
        }
        
        .send-button {
            background: linear-gradient(135deg, #1e3a8a, #1e40af);
            color: white;
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.3);
        }
        
        .send-button:hover:not(:disabled) {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(30, 58, 138, 0.4);
        }
        
        .send-button:disabled {
            background: linear-gradient(135deg, #9ca3af, #6b7280);
            cursor: not-allowed;
            box-shadow: none;
        }

        .report-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .report-header {
            background: linear-gradient(135deg, #1e3a8a, #1e40af);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        @keyframes slideIn {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        @media print {
            .header, .input-area, .chat-header {
                display: none;
            }
            
            .chat-card {
                height: auto;
                box-shadow: none;
            }
            
            .chat-messages {
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-container">
            <div class="logo">CELLOXEN</div>
            <div class="lily-info">
                <h1>Lily - Bioelectronic Wellness Consultant</h1>
                <p>Comprehensive Health Assessment & Therapy Recommendation System</p>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="session-info">
            <div>
                <h3>Wellness Assessment Session</h3>
                <p>Personalised bioelectronic therapy recommendations</p>
            </div>
            <div class="session-badge">
                Session: <span id="sessionId"></span>
            </div>
        </div>
        
        <div class="chat-card">
            <div class="chat-header" style="padding: 20px 25px; border-bottom: 1px solid #e2e8f0;">
                <div class="lily-avatar" style="width: 48px; height: 48px; border-radius: 50%; background: linear-gradient(135deg, #1e3a8a, #1e40af); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">L</div>
                <div>
                    <div style="font-weight: 600; color: #1f2937;">Lily Wellness Consultant</div>
                    <div style="color: #10b981; font-size: 0.85rem;">Online & Ready</div>
                </div>
            </div>
            
            <div class="chat-messages" id="chatMessages"></div>
            
            <div class="input-area">
                <div class="input-container">
                    <input type="text" class="input-field" id="userInput" placeholder="Type your response..." disabled>
                    <button class="send-button" id="sendButton" onclick="sendMessage()" disabled>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // COMPLETE CELLOXEN HEALTH ASSESSMENT SYSTEM
        class LilyHealthConsultant {
            constructor() {
                this.sessionId = this.generateSessionId();
                this.currentStep = 'greeting';
                this.conversationLog = [];
                this.sessionData = {};
                this.responses = [];
                this.domainScores = {};
                this.currentQuestionIndex = 0;
                
                // Complete therapy database with all details
                this.therapyDatabase = this.loadCompleteTherapyDatabase();
                
                // Comprehensive question sets
                this.initialQuestions = this.getInitialScreeningQuestions();
                this.targetedQuestions = [];
                
                this.init();
            }
            
            generateSessionId() {
                const sessionId = `LILY-${Date.now()}-${Math.random().toString(36).substr(2, 9).toUpperCase()}`;
                document.getElementById('sessionId').textContent = sessionId;
                return sessionId;
            }
            
            loadCompleteTherapyDatabase() {
                return {
                    '101': {
                        name: 'Deep Sleep Renewal Therapy',
                        code: '101',
                        domain: 'sleep',
                        description: 'Deep Sleep Renewal Therapy is a gentle bioelectronic wellness therapy that helps restore your body\'s natural ability to achieve restful, rejuvenating sleep. Using advanced technology, it calms your nervous system and prepares your body for deep, restorative sleep cycles.',
                        howItWorks: 'This wellness therapy uses gentle bioelectronic signals to support your body\'s natural relaxation and sleep processes. It helps calm the busy mind by supporting the natural transition from daytime alertness to evening relaxation. The therapy encourages natural production of calming signals while reducing stress responses that interfere with sleep.',
                        prescribedFor: [
                            'Difficulty falling asleep within 30 minutes',
                            'Waking multiple times during the night',
                            'Early morning awakening',
                            'Feeling unrefreshed despite time in bed',
                            'Sleep anxiety',
                            'Restlessness at bedtime'
                        ],
                        benefits: {
                            immediate: ['Greater relaxation at bedtime', 'Calmer mind when lying down'],
                            shortTerm: ['Falling asleep more easily', 'Fewer night-time disturbances'],
                            mediumTerm: ['Consistent sleep schedule', 'Deeper, more satisfying rest'],
                            longTerm: ['Natural sleep patterns restored', 'Better stress resilience']
                        },
                        duration: '45 minutes',
                        frequency: '2-3 times per week',
                        course: '8 weeks',
                        sessions: '16-24 sessions',
                        supplements: [
                            { name: 'Magnesium Glycinate', dose: '400mg', benefit: 'Promotes muscle relaxation and calm sleep' },
                            { name: 'Vitamin B Complex', dose: 'As directed', benefit: 'Supports nervous system health' },
                            { name: 'L-Theanine', dose: '200mg', benefit: 'Natural relaxation without drowsiness' },
                            { name: 'Melatonin', dose: '3mg', benefit: 'Regulates sleep-wake cycle' },
                            { name: 'Ashwagandha', dose: '500mg', benefit: 'Reduces stress and improves sleep quality' }
                        ]
                    },
                    '102': {
                        name: 'Stress Relief Therapy',
                        code: '102',
                        domain: 'stress',
                        description: 'Stress Relief Therapy is a calming bioelectronic wellness therapy that helps your body release accumulated tension and return to its natural state of balance.',
                        howItWorks: 'This therapy employs gentle bioelectronic signals to support your body\'s natural stress relief pathways. It helps activate your relaxation response while supporting the release of physical tension patterns that develop from prolonged stress.',
                        prescribedFor: [
                            'Chronic workplace pressure',
                            'Daily life stress',
                            'Tension headaches',
                            'Shoulder and neck tightness',
                            'Stress-related digestive upset',
                            'Emotional exhaustion'
                        ],
                        benefits: {
                            immediate: ['Deep sense of calm', 'Muscle tension release'],
                            shortTerm: ['Better stress response', 'Improved sleep quality'],
                            mediumTerm: ['Sustained lower stress', 'Better work performance'],
                            longTerm: ['Fundamental stress resilience', 'Better life balance']
                        },
                        duration: '35 minutes',
                        frequency: '1-2 times per week',
                        course: '8 weeks',
                        sessions: '8-16 sessions',
                        supplements: [
                            { name: 'Vitamin B Complex', dose: 'As directed', benefit: 'Essential for nervous system support' },
                            { name: 'Omega-3', dose: '1000mg EPA/DHA', benefit: 'Reduces inflammation and supports mood' },
                            { name: 'Magnesium Citrate', dose: '300mg', benefit: 'Natural muscle relaxant' },
                            { name: 'Vitamin D3', dose: '2000 IU', benefit: 'Mood regulation and immune support' },
                            { name: 'Rhodiola', dose: '200mg', benefit: 'Adaptogen for stress resistance' }
                        ]
                    },
                    '301': {
                        name: 'Heart Health Therapy',
                        code: '301',
                        domain: 'cardiovascular',
                        description: 'Heart Health Therapy is a comprehensive bioelectronic wellness therapy that supports cardiovascular vitality and overall heart wellness.',
                        howItWorks: 'This therapy employs gentle bioelectronic signals to support optimal heart function. It enhances natural energy flow through the heart region, supporting circulation and cardiovascular efficiency.',
                        prescribedFor: [
                            'Supporting heart wellness with family history',
                            'Maintaining cardiovascular health with aging',
                            'Athletic heart support',
                            'General cardiovascular wellness',
                            'Supporting healthy circulation',
                            'Preventive heart wellness'
                        ],
                        benefits: {
                            immediate: ['Increased energy', 'Better breathing comfort'],
                            shortTerm: ['Better exercise comfort', 'Improved daily stamina'],
                            mediumTerm: ['Significantly improved endurance', 'Better overall fitness'],
                            longTerm: ['Sustained heart wellness', 'Optimal cardiovascular function']
                        },
                        duration: '45 minutes',
                        frequency: '2 times per week',
                        course: '10-12 weeks',
                        sessions: '20-24 sessions',
                        supplements: [
                            { name: 'CoQ10', dose: '100mg', benefit: 'Essential for heart energy production' },
                            { name: 'Omega-3', dose: '1500mg EPA/DHA', benefit: 'Cardiovascular protection' },
                            { name: 'Magnesium Taurate', dose: '400mg', benefit: 'Heart rhythm support' },
                            { name: 'Hawthorn Berry', dose: '500mg', benefit: 'Traditional heart tonic' },
                            { name: 'Vitamin K2', dose: '100mcg', benefit: 'Arterial health' }
                        ]
                    },
                    '401': {
                        name: 'Gout Relief Therapy',
                        code: '401',
                        domain: 'joint',
                        description: 'Gout Relief Therapy is a targeted bioelectronic wellness therapy designed to support comfort and balance in joints affected by uric acid imbalances.',
                        howItWorks: 'This therapy uses targeted bioelectronic signals to support joint comfort and metabolic balance. It enhances your body\'s natural ability to process and eliminate substances that can accumulate in joints.',
                        prescribedFor: [
                            'Acute joint discomfort from gout',
                            'Recurring gout flares',
                            'High uric acid levels',
                            'Joint stiffness and swelling',
                            'Supporting metabolic balance',
                            'Post-flare recovery'
                        ],
                        benefits: {
                            immediate: ['Discomfort reduction', 'Decreased swelling'],
                            shortTerm: ['Resolution of acute symptoms', 'Normal joint function'],
                            mediumTerm: ['Better metabolic balance', 'Enhanced comfort'],
                            longTerm: ['Fewer flares', 'Better joint health']
                        },
                        duration: '40 minutes',
                        frequency: '2-3 times per week',
                        course: '6-8 weeks',
                        sessions: '15-20 sessions',
                        supplements: [
                            { name: 'Vitamin C', dose: '1000mg', benefit: 'Helps reduce uric acid' },
                            { name: 'Cherry Extract', dose: '600mg', benefit: 'Natural anti-inflammatory' },
                            { name: 'Celery Seed Extract', dose: '150mg', benefit: 'Traditional gout remedy' },
                            { name: 'Bromelain', dose: '500mg', benefit: 'Reduces inflammation' },
                            { name: 'Folic Acid', dose: '400mcg', benefit: 'Helps break down uric acid' }
                        ]
                    },
                    '601': {
                        name: 'Digestive Balance Therapy',
                        code: '601',
                        domain: 'digestive',
                        description: 'Digestive Balance Therapy is a comprehensive bioelectronic wellness therapy that supports optimal digestive function and gut wellness.',
                        howItWorks: 'This therapy uses gentle bioelectronic signals to support optimal digestive function. It helps support natural digestive rhythm while encouraging healthy gut-brain communication.',
                        prescribedFor: [
                            'Irregular bowel patterns',
                            'Bloating and gas discomfort',
                            'Digestive upset after meals',
                            'Acid reflux sensations',
                            'Constipation concerns',
                            'General gut health support'
                        ],
                        benefits: {
                            immediate: ['Reduced bloating', 'Greater comfort after meals'],
                            shortTerm: ['Regular elimination', 'Reduced gas discomfort'],
                            mediumTerm: ['Normalized digestive function', 'Better nutrient utilization'],
                            longTerm: ['Sustained digestive comfort', 'Optimal gut wellness']
                        },
                        duration: '40 minutes',
                        frequency: '2 times per week',
                        course: '8 weeks',
                        sessions: '16 sessions',
                        supplements: [
                            { name: 'Probiotic Blend', dose: '50 billion CFU', benefit: 'Gut flora balance' },
                            { name: 'Digestive Enzymes', dose: 'With meals', benefit: 'Improve food breakdown' },
                            { name: 'L-Glutamine', dose: '5g', benefit: 'Gut lining repair' },
                            { name: 'Peppermint Oil', dose: '200mg', benefit: 'IBS relief' },
                            { name: 'Ginger Extract', dose: '250mg', benefit: 'Natural digestive aid' }
                        ]
                    }
                };
            }
            
            getInitialScreeningQuestions() {
                return [
                    // Sleep domain questions
                    {
                        id: 'sleep1',
                        text: 'How would you rate the quality of your sleep?',
                        domain: 'sleep',
                        weight: 1.0,
                        options: [
                            { text: 'Excellent - I wake refreshed', score: 0 },
                            { text: 'Good - Usually satisfactory', score: 25 },
                            { text: 'Fair - Sometimes problematic', score: 50 },
                            { text: 'Poor - Frequently disrupted', score: 75 },
                            { text: 'Very poor - Chronic issues', score: 100 }
                        ]
                    },
                    {
                        id: 'sleep2',
                        text: 'How long does it typically take you to fall asleep?',
                        domain: 'sleep',
                        weight: 0.8,
                        options: [
                            { text: 'Less than 15 minutes', score: 0 },
                            { text: '15-30 minutes', score: 25 },
                            { text: '30-45 minutes', score: 50 },
                            { text: '45-60 minutes', score: 75 },
                            { text: 'More than 60 minutes', score: 100 }
                        ]
                    },
                    {
                        id: 'sleep3',
                        text: 'How often do you wake during the night?',
                        domain: 'sleep',
                        weight: 0.9,
                        options: [
                            { text: 'Rarely or never', score: 0 },
                            { text: 'Once occasionally', score: 25 },
                            { text: '1-2 times regularly', score: 50 },
                            { text: '3-4 times', score: 75 },
                            { text: 'More than 4 times', score: 100 }
                        ]
                    },
                    // Stress domain questions
                    {
                        id: 'stress1',
                        text: 'How would you describe your current stress levels?',
                        domain: 'stress',
                        weight: 1.0,
                        options: [
                            { text: 'Very low - I feel calm', score: 0 },
                            { text: 'Low - Manageable', score: 25 },
                            { text: 'Moderate - Sometimes challenging', score: 50 },
                            { text: 'High - Often overwhelming', score: 75 },
                            { text: 'Very high - Constant pressure', score: 100 }
                        ]
                    },
                    {
                        id: 'stress2',
                        text: 'Do you experience physical symptoms of stress?',
                        domain: 'stress',
                        weight: 0.9,
                        options: [
                            { text: 'Never', score: 0 },
                            { text: 'Rarely', score: 25 },
                            { text: 'Sometimes', score: 50 },
                            { text: 'Often', score: 75 },
                            { text: 'Constantly', score: 100 }
                        ]
                    },
                    {
                        id: 'stress3',
                        text: 'How well do you manage daily pressures?',
                        domain: 'stress',
                        weight: 0.8,
                        options: [
                            { text: 'Very well - I stay balanced', score: 0 },
                            { text: 'Well - Usually cope', score: 25 },
                            { text: 'Adequately - Some struggles', score: 50 },
                            { text: 'Poorly - Often overwhelmed', score: 75 },
                            { text: 'Very poorly - Cannot cope', score: 100 }
                        ]
                    },
                    // Cardiovascular domain questions
                    {
                        id: 'cardio1',
                        text: 'How is your energy during physical activity?',
                        domain: 'cardiovascular',
                        weight: 1.0,
                        options: [
                            { text: 'Excellent - High stamina', score: 0 },
                            { text: 'Good - Adequate energy', score: 25 },
                            { text: 'Fair - Some limitations', score: 50 },
                            { text: 'Poor - Easily tired', score: 75 },
                            { text: 'Very poor - Minimal activity', score: 100 }
                        ]
                    },
                    {
                        id: 'cardio2',
                        text: 'Do you experience shortness of breath?',
                        domain: 'cardiovascular',
                        weight: 0.9,
                        options: [
                            { text: 'Never', score: 0 },
                            { text: 'Only with intense exercise', score: 25 },
                            { text: 'With moderate activity', score: 50 },
                            { text: 'With mild activity', score: 75 },
                            { text: 'Even at rest', score: 100 }
                        ]
                    },
                    // Joint domain questions
                    {
                        id: 'joint1',
                        text: 'Do you experience joint discomfort?',
                        domain: 'joint',
                        weight: 1.0,
                        options: [
                            { text: 'Never', score: 0 },
                            { text: 'Rarely', score: 25 },
                            { text: 'Sometimes', score: 50 },
                            { text: 'Often', score: 75 },
                            { text: 'Constantly', score: 100 }
                        ]
                    },
                    {
                        id: 'joint2',
                        text: 'Does joint stiffness affect your morning routine?',
                        domain: 'joint',
                        weight: 0.8,
                        options: [
                            { text: 'No stiffness', score: 0 },
                            { text: 'Minimal - resolves quickly', score: 25 },
                            { text: 'Moderate - 15-30 minutes', score: 50 },
                            { text: 'Significant - 30-60 minutes', score: 75 },
                            { text: 'Severe - over 60 minutes', score: 100 }
                        ]
                    },
                    // Digestive domain questions
                    {
                        id: 'digestive1',
                        text: 'How comfortable is your digestion after meals?',
                        domain: 'digestive',
                        weight: 1.0,
                        options: [
                            { text: 'Very comfortable', score: 0 },
                            { text: 'Usually comfortable', score: 25 },
                            { text: 'Sometimes uncomfortable', score: 50 },
                            { text: 'Often uncomfortable', score: 75 },
                            { text: 'Always problematic', score: 100 }
                        ]
                    },
                    {
                        id: 'digestive2',
                        text: 'Do you experience bloating or gas?',
                        domain: 'digestive',
                        weight: 0.8,
                        options: [
                            { text: 'Never', score: 0 },
                            { text: 'Rarely', score: 25 },
                            { text: 'Sometimes', score: 50 },
                            { text: 'Often', score: 75 },
                            { text: 'Daily', score: 100 }
                        ]
                    },
                    // Kidney domain questions
                    {
                        id: 'kidney1',
                        text: 'Do you experience fluid retention or swelling?',
                        domain: 'kidney',
                        weight: 1.0,
                        options: [
                            { text: 'Never', score: 0 },
                            { text: 'Rarely', score: 25 },
                            { text: 'Sometimes', score: 50 },
                            { text: 'Often', score: 75 },
                            { text: 'Constantly', score: 100 }
                        ]
                    },
                    // Energy domain questions
                    {
                        id: 'energy1',
                        text: 'How would you describe your daily energy levels?',
                        domain: 'energy',
                        weight: 1.0,
                        options: [
                            { text: 'Excellent - Sustained vitality', score: 0 },
                            { text: 'Good - Adequate energy', score: 25 },
                            { text: 'Fair - Some fatigue', score: 50 },
                            { text: 'Poor - Often tired', score: 75 },
                            { text: 'Very poor - Exhausted', score: 100 }
                        ]
                    },
                    // Metabolic domain questions
                    {
                        id: 'metabolic1',
                        text: 'How stable are your energy levels after meals?',
                        domain: 'metabolic',
                        weight: 1.0,
                        options: [
                            { text: 'Very stable', score: 0 },
                            { text: 'Mostly stable', score: 25 },
                            { text: 'Some fluctuations', score: 50 },
                            { text: 'Significant crashes', score: 75 },
                            { text: 'Severe instability', score: 100 }
                        ]
                    }
                ];
            }
            
            async init() {
                await this.showGreeting();
                this.enableInput();
            }
            
            async showGreeting() {
                const hour = new Date().getHours();
                let greeting = hour < 12 ? "Good morning" : hour < 17 ? "Good afternoon" : "Good evening";
                
                await this.addMessage(`${greeting}! I am Lily, your Celloxen Bioelectronic Wellness Consultant. I'm here to conduct a comprehensive health assessment to identify the most suitable wellness therapies for your needs.`, 'lily');
                await this.delay(2000);
                await this.addMessage("May I have your name, please?", 'lily');
            }
            
            async addMessage(text, sender, options = null) {
                const messagesContainer = document.getElementById('chatMessages');
                const messageWrapper = document.createElement('div');
                messageWrapper.className = `message-wrapper ${sender}-wrapper`;
                
                if (sender === 'processing') {
                    messageWrapper.innerHTML = `
                        <div class="processing">
                            <span>Lily is analysing your responses...</span>
                            <div class="dots">
                                <div class="dot"></div>
                                <div class="dot"></div>
                                <div class="dot"></div>
                            </div>
                        </div>
                    `;
                } else {
                    let messageContent = text;
                    
                    if (options) {
                        const optionsHtml = options.map((opt, idx) => {
                            const optText = typeof opt === 'string' ? opt : opt.text;
                            return `<div class="choice-button" onclick="lily.selectChoice(${idx})">${optText}</div>`;
                        }).join('');
                        
                        messageContent += `<div class="multiple-choice">${optionsHtml}</div>`;
                    }
                    
                    messageWrapper.innerHTML = `
                        <div class="message ${sender}-message">
                            ${messageContent}
                        </div>
                    `;
                }
                
                messagesContainer.appendChild(messageWrapper);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                return messageWrapper;
            }
            
            async processUserInput(input) {
                await this.addMessage(input, 'user');
                this.disableInput();
                
                const processingMsg = await this.addMessage('', 'processing');
                await this.delay(2000);
                processingMsg.remove();
                
                switch(this.currentStep) {
                    case 'greeting':
                        await this.handlePractitionerName(input);
                        break;
                    case 'patient_name':
                        await this.handlePatientName(input);
                        break;
                    case 'patient_age':
                        await this.handlePatientAge(input);
                        break;
                    case 'confirmation':
                        await this.handleConfirmation(input);
                        break;
                    case 'assessment':
                        await this.handleAssessmentResponse(input);
                        break;
                    case 'targeted':
                        await this.handleTargetedResponse(input);
                        break;
                    case 'complete':
                        await this.handleCompletionOptions(input);
                        break;
                }
                
                this.enableInput();
            }
            
            async selectChoice(index) {
                this.disableInput();
                
                if (this.currentStep === 'patient_gender') {
                    const genders = ['Male', 'Female', 'Prefer not to say'];
                    await this.processUserInput(genders[index]);
                } else if (this.currentStep === 'assessment') {
                    const question = this.initialQuestions[this.currentQuestionIndex];
                    const selectedOption = question.options[index];
                    await this.handleAssessmentResponse(selectedOption);
                } else if (this.currentStep === 'targeted') {
                    const question = this.targetedQuestions[this.currentQuestionIndex];
                    const selectedOption = question.options[index];
                    await this.handleTargetedResponse(selectedOption);
                } else if (this.currentStep === 'confirmation') {
                    const options = ['Yes, proceed', 'No, cancel'];
                    await this.processUserInput(options[index]);
                } else if (this.currentStep === 'complete') {
                    const options = ['Download Report', 'Email Report', 'Start New Assessment', 'End Session'];
                    await this.processUserInput(options[index]);
                }
            }
            
            async handlePractitionerName(name) {
                this.sessionData.practitionerName = name;
                await this.addMessage(`Thank you, ${name}. Now, may I have the patient's full name?`, 'lily');
                this.currentStep = 'patient_name';
            }
            
            async handlePatientName(name) {
                this.sessionData.patientName = name;
                await this.addMessage(`Thank you. What is ${name}'s age?`, 'lily');
                this.currentStep = 'patient_age';
            }
            
            async handlePatientAge(age) {
                const ageNum = parseInt(age);
                if (isNaN(ageNum) || ageNum < 1 || ageNum > 120) {
                    await this.addMessage("Please provide a valid age between 1 and 120.", 'lily');
                    return;
                }
                
                this.sessionData.patientAge = ageNum;
                await this.addMessage("What is the patient's gender?", 'lily', ['Male', 'Female', 'Prefer not to say']);
                this.currentStep = 'patient_gender';
            }
            
            async processUserInput(input) {
                // Handle gender selection as special case
                if (this.currentStep === 'patient_gender') {
                    this.sessionData.patientGender = input;
                    await this.addMessage(input, 'user');
                    this.disableInput();
                    
                    const processingMsg = await this.addMessage('', 'processing');
                    await this.delay(1500);
                    processingMsg.remove();
                    
                    await this.addMessage(`Perfect. Let me confirm the details:

- Practitioner: ${this.sessionData.practitionerName}
- Patient: ${this.sessionData.patientName}  
- Age: ${this.sessionData.patientAge}
- Gender: ${this.sessionData.patientGender}

Shall we proceed with the comprehensive wellness assessment?`, 'lily', ['Yes, proceed', 'No, cancel']);
                    
                    this.currentStep = 'confirmation';
                    this.enableInput();
                    return;
                }
                
                // Handle other inputs normally
                await this.addMessage(input, 'user');
                this.disableInput();
                
                const processingMsg = await this.addMessage('', 'processing');
                await this.delay(2000);
                processingMsg.remove();
                
                switch(this.currentStep) {
                    case 'greeting':
                        await this.handlePractitionerName(input);
                        break;
                    case 'patient_name':
                        await this.handlePatientName(input);
                        break;
                    case 'patient_age':
                        await this.handlePatientAge(input);
                        break;
                    case 'confirmation':
                        await this.handleConfirmation(input);
                        break;
                    case 'complete':
                        await this.handleCompletionOptions(input);
                        break;
                }
                
                this.enableInput();
            }
            
            async handleConfirmation(response) {
                if (response.includes('Yes')) {
                    await this.startAssessment();
                } else {
                    await this.addMessage("Assessment cancelled. Thank you for your time.", 'lily');
                    this.disableInput();
                }
            }
            
            async startAssessment() {
                await this.addMessage(`Excellent! I'll now conduct a comprehensive wellness assessment for ${this.sessionData.patientName}.`, 'lily');
                await this.delay(2000);
                await this.addMessage("I'll ask 15 initial screening questions to understand the primary health concerns. Please answer based on the patient's current condition.", 'lily');
                await this.delay(2000);
                
                this.currentQuestionIndex = 0;
                this.currentStep = 'assessment';
                await this.askNextQuestion();
            }
            
            async askNextQuestion() {
                const questions = this.initialQuestions;
                if (this.currentQuestionIndex < questions.length) {
                    const question = questions[this.currentQuestionIndex];
                    const questionNumber = this.currentQuestionIndex + 1;
                    const totalQuestions = questions.length;
                    
                    const progressPercentage = (questionNumber / totalQuestions) * 100;
                    
                    const progressHtml = `
                        <div class="question-progress">
                            <div class="question-progress-bar" style="width: ${progressPercentage}%"></div>
                        </div>
                        Question ${questionNumber} of ${totalQuestions}: ${question.text}
                    `;
                    
                    const options = question.options.map(opt => opt.text);
                    await this.addMessage(progressHtml, 'lily', options);
                } else {
                    await this.completeInitialAssessment();
                }
            }
            
            async handleAssessmentResponse(response) {
                const question = this.initialQuestions[this.currentQuestionIndex];
                
                // Find the selected option
                let selectedOption = question.options.find(opt => opt.text === response.text || opt.text === response);
                if (!selectedOption && typeof response === 'object') {
                    selectedOption = response;
                }
                
                // Store response with weighted score
                this.responses.push({
                    question: question.text,
                    response: selectedOption.text,
                    domain: question.domain,
                    score: selectedOption.score,
                    weightedScore: selectedOption.score * question.weight
                });
                
                // Update domain scores
                if (!this.domainScores[question.domain]) {
                    this.domainScores[question.domain] = {
                        totalScore: 0,
                        totalWeight: 0,
                        responses: 0
                    };
                }
                
                this.domainScores[question.domain].totalScore += selectedOption.score * question.weight;
                this.domainScores[question.domain].totalWeight += question.weight;
                this.domainScores[question.domain].responses++;
                
                this.currentQuestionIndex++;
                await this.askNextQuestion();
            }
            
            async completeInitialAssessment() {
                await this.addMessage("Initial assessment complete! Let me analyse these responses...", 'lily');
                
                const processingMsg = await this.addMessage('', 'processing');
                await this.delay(3000);
                processingMsg.remove();
                
                // Calculate final domain scores
                const finalScores = {};
                for (const [domain, data] of Object.entries(this.domainScores)) {
                    finalScores[domain] = Math.round(data.totalScore / data.totalWeight);
                }
                
                // Sort domains by score (highest concern first)
                const sortedDomains = Object.entries(finalScores)
                    .sort((a, b) => b[1] - a[1])
                    .filter(([domain, score]) => score > 30); // Only consider domains with significant issues
                
                // Generate targeted questions based on top concerns
                await this.generateTargetedQuestions(sortedDomains.slice(0, 3));
                
                // Display initial findings
                let findingsMessage = `Initial Assessment Findings for ${this.sessionData.patientName}:\n\n`;
                
                for (const [domain, score] of Object.entries(finalScores)) {
                    const status = score < 30 ? '✅ Excellent' : 
                                 score < 50 ? '🟡 Good' : 
                                 score < 70 ? '🟠 Needs attention' : '🔴 Significant concern';
                    findingsMessage += `${this.formatDomain(domain)}: ${status} (${100-score}% wellness)\n`;
                }
                
                await this.addMessage(findingsMessage, 'lily');
                await this.delay(2500);
                
                if (this.targetedQuestions.length > 0) {
                    await this.addMessage(`Based on these findings, I need to ask ${this.targetedQuestions.length} targeted questions to refine my therapy recommendations.`, 'lily');
                    await this.delay(2000);
                    
                    this.currentQuestionIndex = 0;
                    this.currentStep = 'targeted';
                    await this.askTargetedQuestion();
                } else {
                    await this.generateFinalReport();
                }
            }
            
            async generateTargetedQuestions(topDomains) {
                this.targetedQuestions = [];
                
                for (const [domain, score] of topDomains) {
                    if (domain === 'sleep' && score > 50) {
                        this.targetedQuestions.push(
                            {
                                text: 'What is the main sleep challenge?',
                                domain: 'sleep',
                                weight: 1.2,
                                options: [
                                    { text: 'Falling asleep', score: 100 },
                                    { text: 'Staying asleep', score: 80 },
                                    { text: 'Early waking', score: 60 },
                                    { text: 'Non-restorative sleep', score: 70 }
                                ]
                            },
                            {
                                text: 'Are there contributing factors to sleep issues?',
                                domain: 'sleep',
                                weight: 0.8,
                                options: [
                                    { text: 'Stress/anxiety', score: 90 },
                                    { text: 'Physical discomfort', score: 70 },
                                    { text: 'Environmental factors', score: 50 },
                                    { text: 'No clear cause', score: 60 }
                                ]
                            }
                        );
                    }
                    
                    if (domain === 'stress' && score > 50) {
                        this.targetedQuestions.push(
                            {
                                text: 'What is the primary source of stress?',
                                domain: 'stress',
                                weight: 1.2,
                                options: [
                                    { text: 'Work/career', score: 80 },
                                    { text: 'Personal relationships', score: 70 },
                                    { text: 'Health concerns', score: 90 },
                                    { text: 'Financial pressures', score: 75 }
                                ]
                            },
                            {
                                text: 'How is stress affecting daily life?',
                                domain: 'stress',
                                weight: 1.0,
                                options: [
                                    { text: 'Severely limiting activities', score: 100 },
                                    { text: 'Moderately affecting function', score: 70 },
                                    { text: 'Mild interference', score: 40 },
                                    { text: 'Minimal impact', score: 20 }
                                ]
                            }
                        );
                    }
                    
                    if (domain === 'joint' && score > 50) {
                        this.targetedQuestions.push(
                            {
                                text: 'Which joints are most affected?',
                                domain: 'joint',
                                weight: 1.0,
                                options: [
                                    { text: 'Large joints (knees, hips)', score: 90 },
                                    { text: 'Small joints (fingers, toes)', score: 80 },
                                    { text: 'Spine', score: 85 },
                                    { text: 'Multiple areas', score: 100 }
                                ]
                            }
                        );
                    }
                }
            }
            
            async askTargetedQuestion() {
                if (this.currentQuestionIndex < this.targetedQuestions.length) {
                    const question = this.targetedQuestions[this.currentQuestionIndex];
                    const questionNumber = this.currentQuestionIndex + 1;
                    
                    const progressPercentage = (questionNumber / this.targetedQuestions.length) * 100;
                    
                    const progressHtml = `
                        <div class="question-progress">
                            <div class="question-progress-bar" style="width: ${progressPercentage}%"></div>
                        </div>
                        Targeted Question ${questionNumber} of ${this.targetedQuestions.length}: ${question.text}
                    `;
                    
                    const options = question.options.map(opt => opt.text);
                    await this.addMessage(progressHtml, 'lily', options);
                } else {
                    await this.generateFinalReport();
                }
            }
            
            async handleTargetedResponse(response) {
                const question = this.targetedQuestions[this.currentQuestionIndex];
                
                let selectedOption = question.options.find(opt => opt.text === response.text || opt.text === response);
                if (!selectedOption && typeof response === 'object') {
                    selectedOption = response;
                }
                
                // Update domain scores with targeted responses
                this.domainScores[question.domain].totalScore += selectedOption.score * question.weight;
                this.domainScores[question.domain].totalWeight += question.weight;
                
                this.currentQuestionIndex++;
                await this.askTargetedQuestion();
            }
            
            async generateFinalReport() {
                await this.addMessage("Assessment complete! Generating your comprehensive wellness report...", 'lily');
                
                const processingMsg = await this.addMessage('', 'processing');
                await this.delay(4000);
                processingMsg.remove();
                
                // Recalculate final scores
                const finalScores = {};
                for (const [domain, data] of Object.entries(this.domainScores)) {
                    finalScores[domain] = Math.round(data.totalScore / data.totalWeight);
                }
                
                // Generate therapy recommendations
                const recommendations = [];
                for (const [domain, score] of Object.entries(finalScores)) {
                    if (score > 40) { // Recommend therapy for domains with issues
                        const therapies = Object.values(this.therapyDatabase)
                            .filter(t => t.domain === domain);
                        
                        if (therapies.length > 0) {
                            recommendations.push({
                                therapy: therapies[0],
                                priority: score > 70 ? 'PRIMARY' : score > 50 ? 'SECONDARY' : 'SUPPORTIVE',
                                score: score
                            });
                        }
                    }
                }
                
                // Sort recommendations by priority
                recommendations.sort((a, b) => b.score - a.score);
                
                // Display comprehensive report
                const reportHtml = `
                    <div class="report-section">
                        <div class="report-header">
                            <h2>Comprehensive Wellness Assessment Report</h2>
                            <p>Patient: ${this.sessionData.patientName} | Age: ${this.sessionData.patientAge} | Gender: ${this.sessionData.patientGender}</p>
                            <p>Assessment Date: ${new Date().toLocaleDateString()}</p>
                        </div>
                    </div>
                `;
                
                await this.addMessage(reportHtml, 'lily');
                
                // Display recommended therapies with full details
                if (recommendations.length > 0) {
                    await this.addMessage(`Based on comprehensive analysis, I recommend the following bioelectronic wellness therapies:`, 'lily');
                    
                    for (const rec of recommendations.slice(0, 3)) { // Top 3 recommendations
                        const therapy = rec.therapy;
                        
                        const therapyHtml = `
                            <div class="therapy-recommendation">
                                <div class="therapy-title">
                                    ${rec.priority} RECOMMENDATION: ${therapy.name}
                                    <span class="therapy-code">Code ${therapy.code}</span>
                                </div>
                                
                                <div class="therapy-details">
                                    <strong>What is This Therapy?</strong><br>
                                    ${therapy.description}<br><br>
                                    
                                    <strong>How Does It Work?</strong><br>
                                    ${therapy.howItWorks}<br><br>
                                    
                                    <strong>Expected Benefits:</strong><br>
                                    • Immediate: ${therapy.benefits.immediate.join(', ')}<br>
                                    • Short-term (2-4 weeks): ${therapy.benefits.shortTerm.join(', ')}<br>
                                    • Medium-term (5-6 weeks): ${therapy.benefits.mediumTerm.join(', ')}<br>
                                    • Long-term (7-8+ weeks): ${therapy.benefits.longTerm.join(', ')}<br><br>
                                    
                                    <strong>Treatment Plan:</strong><br>
                                    • Duration: ${therapy.duration} per session<br>
                                    • Frequency: ${therapy.frequency}<br>
                                    • Full Course: ${therapy.course}<br>
                                    • Total Sessions: ${therapy.sessions}
                                </div>
                                
                                <div class="supplement-box">
                                    <div class="supplement-title">💊 Recommended Nutritional Support:</div>
                                    ${therapy.supplements.map(s => 
                                        `• <strong>${s.name}</strong> (${s.dose}) - ${s.benefit}`
                                    ).join('<br>')}
                                </div>
                            </div>
                        `;
                        
                        await this.addMessage(therapyHtml, 'lily');
                        await this.delay(1500);
                    }
                }
                
                await this.addMessage("Would you like to:", 'lily', [
                    'Download Report',
                    'Email Report',  
                    'Start New Assessment',
                    'End Session'
                ]);
                
                this.currentStep = 'complete';
            }
            
            async handleCompletionOptions(option) {
                switch(option) {
                    case 'Download Report':
                        await this.addMessage("To download the report, please print this page using your browser's print function (Ctrl+P or Cmd+P) and save as PDF.", 'lily');
                        window.print();
                        break;
                    case 'Email Report':
                        await this.addMessage("Email functionality will be available soon. For now, please use the download option.", 'lily');
                        break;
                    case 'Start New Assessment':
                        location.reload();
                        break;
                    case 'End Session':
                        await this.addMessage(`Thank you for using the Celloxen Wellness Assessment System. The recommendations provided will help ${this.sessionData.patientName} on their wellness journey. Have a wonderful day!`, 'lily');
                        this.disableInput();
                        break;
                }
            }
            
            formatDomain(domain) {
                const formats = {
                    sleep: 'Sleep Quality',
                    stress: 'Stress Management',
                    cardiovascular: 'Cardiovascular Health',
                    joint: 'Joint Health',
                    digestive: 'Digestive Wellness',
                    kidney: 'Kidney Function',
                    energy: 'Energy Levels',
                    metabolic: 'Metabolic Health'
                };
                return formats[domain] || domain;
            }
            
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            
            enableInput() {
                document.getElementById('userInput').disabled = false;
                document.getElementById('sendButton').disabled = false;
                document.getElementById('userInput').focus();
            }
            
            disableInput() {
                document.getElementById('userInput').disabled = true;
                document.getElementById('sendButton').disabled = true;
            }
        }
        
        // Initialize Lily
        let lily;
        
        window.onload = function() {
            lily = new LilyHealthConsultant();
        };
        
        function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            if (message) {
                lily.processUserInput(message);
                input.value = '';
            }
        }
        
        document.getElementById('userInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
